<!DOCTYPE html>
<link rel="stylesheet" href="stylesheet.css">
<html>
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"> 
        <title>
            The Shoppies
        </title>
    </head>
    <body>
        <h1>&#x1F6C8</h1>
        <div id='info_box'>
            <h2 id='close_button'>&#10005</h2>
            <h3>
                This project was built by Saagar Arya<br>
            </h3>
            <img id='me' src="images/me.jpg">
            <h4>for the UX & Web Developer Intern Challenge<br>
                Summer 2021 by Shopify.
            </h4>
            <h5>
                <a href="https://github.com/skarya22/shopify-summer2021-intern-challenge" target="_blank">Click here to see this project on GitHub</a><br>
                <a href="https://www.linkedin.com/in/saagar-arya/" target="_blank">Click here to connect on LinkedIn</a>
            </h5>
        </div>
        <div id="topBar">
            <h3 style="color: #06457c">
                Summer 2021 - Shopify Developer Intern Challenge:
            </h3> 
            <h2>
                The Shoppies: Movie awards for entrepreneurs
            </h2>
        </div>
        <form onSubmit="return search($('input[id=movie_name]').val())">
            <input type="text" id="movie_name">
            <input type="submit" value='Search'></input>
        </form>
        <p id="list"><br></p>
        <button type='button' id='button_0'></button>
        <button type='button' id='button_1'></button>
        <button type='button' id='button_2'></button>
        <p></p>
        <button type='button' id='button_3'></button>
        <button type='button' id='button_4'></button>
        <div id='whitespace'></div>
        <div id='plot_box'></div>
        <div>
            <div class="button_div" id="nominations">
                <table>
                    <th colspan=5>Nominations:</th>
                    <tr>
                        <td class='img_row'><img src="images/nomination_empty.jpg" alt="" id="img_1"></td>
                        <td class='img_row'><img src="images/nomination_empty.jpg" alt="" id="img_2"></td>
                        <td class='img_row'><img src="images/nomination_empty.jpg" alt="" id="img_3"></td>
                        <td class='img_row'><img src="images/nomination_empty.jpg" alt="" id="img_4"></td>
                        <td class='img_row'><img src="images/nomination_empty.jpg" alt="" id="img_5"></td>
                    </tr>
                    <tr>
                        <td><p id="caption_1">Nomination<br>Empty</p></td>
                        <td><p id="caption_2">Nomination<br>Empty</p></td>
                        <td><p id="caption_3">Nomination<br>Empty</p></td>
                        <td><p id="caption_4">Nomination<br>Empty</p></td>
                        <td><p id="caption_5">Nomination<br>Empty</p></td>
                    </tr>
                    <tr>
                        <td><br></td>
                    </tr>
                </table>
            </div>
        </div>
        
        <script>
            array_of_nominations = [$('#img_1'), $('#img_2'), $('#img_3'), $('#img_4'), $('#img_5')]
            array_of_captions = [$('#caption_1'), $('#caption_2'), $('#caption_3'), $('#caption_4'), $('#caption_5')]
            array_of_data = [];
            dataOrder = [];
            allDone = false;
            $('h1').hover(function() {
                $('#info_box').css('display','inline');
                $('#info_box').animate({left: '-35%'})
            }, function() {
                console.log(parseInt($('#topBar').css('width')))
                if(parseInt($('#info_box').css('left')) < 0) {
                    $('#info_box').animate({left: '-50%'})
                }
                
            })
            $('h1').click(function() {
                $('#info_box').animate({left: '30%'})
            });
            $('#close_button').click(function() {
                $('#info_box').animate({left: '-50%'})
            })
            $('button').mouseenter(function() {
                num = $(this).attr('id').substring(7,8);
                for (i = 0; i < dataOrder.length; i++) {
                    if (dataOrder[i] === num) {
                        num = dataOrder[i];
                    }
                }
                this_data = array_of_data[num];
                if (this_data === null || this_data.Poster === 'N/A' || this_data.Poster == null) {
                    $('#plot_box').html("<img id='hover_image' src='images/no_poster.jpg''>");
                } else {
                    $('#plot_box').html("<img id='hover_image' src='" + this_data.Poster + "''>");
                }
                $('#plot_box').append("<p style='color: black'>" + this_data.Plot + "</p>")
                $('#plot_box').append("<p style='color: #50495A'>Actors: " + this_data.Actors + "</p>");
                if (this_data.Ratings[1] != null) {
                    $('#plot_box').append("<p style='color: #FEAD9A'>Rotten Tomatoes: " + this_data.Ratings[1].Value + '</p>');
                } else {
                    $('#plot_box').append('<p style="color: #FEAD9A">Rotten Tomatoes: N/A</p>');
                }
                if (this_data.imdbRating != null) {
                    $('#plot_box').append('<p style="color: #EEC200">imdb Rating: ' + this_data.imdbRating + '</p>');
                }
                isOnLeft = plotOnLeft();
                if (isOnLeft && parseInt($('#plot_box').css('left')) < 0) {
                    $('#plot_box').animate({left: '2.5%'});
                } else if (!isOnLeft && parseInt($('#plot_box').css('left')) > parseInt($('#topBar').css('left'))) {
                    $('#plot_box').animate({left: '62.5%'});
                }
                $('#plot_box').show();                
            })
            
            $('#plot_box').mouseenter(function() {
                if (allDone) {
                    hidePlot();
                    return;
                }
                if (plotOnLeft()) {
                    $('#plot_box').animate({left:'62.5%'});
                } else {
                    $('#plot_box').animate({left: '2.5%'});
                }
            })

            function plotOnLeft() {
                halfScreenWidth = parseInt($('#topBar').css('width'))/2;
                leftWidth = parseInt($('#plot_box').css('left').substring(0,$('#plot_box').css('left').length - 2))
                if (halfScreenWidth < leftWidth) {
                    return false;
                } else {
                    return true;
                }
            }
            function search(String) {
                if (plotOnLeft()) {
                    $('#plot_box').animate({left: '-150%'});
                } else {
                    $('#plot_box').animate({left: '150%'});
                }
                $("#list").html("<br />");
                $.get("https://www.omdbapi.com/?apikey=950b4470&s=" + String + "&type=movie", function(data) {
                    if (data.Response === "False") {
                        $('button').fadeOut(700);
                        $('button').css('display', 'none');
                        return false;
                    } 
                    array_of_data = [];
                    dataOrder = [];
                    anythingAdded = false;
                    for (i = 0; i < 5 && i < data.totalResults && i < 10; i++) {
                        movie = data.Search[i].Title + " (" + data.Search[i].Year +  ")";
                        $('#button_' + i).html(movie);
                        id = data.Search[i].imdbID
                        $('#button_' + i).attr('onclick', 'nominate("' + i + '")');
                        $('#button_' + i).fadeIn(700);
                        $('#button_' + i).css('display', 'inline');
                        addData(id, i);
                    }  
                });       
                return false;
            }
            function addData(id, i) {
                $.get("https://www.omdbapi.com/?apikey=950b4470&i=" + id, function(data) {
                    array_of_data[i] = data;
                });
            }
            function nominate(num) {
                isOnList = false;
                data = array_of_data[num];
                text = data.Title + " (" + data.Year + ")";
                for (i = 0; i < 5; i++) {
                    if (array_of_captions[i].text() === text) {
                        isOnList = true;
                    }
                }
                if (!isOnList) {
                    setPoster(data.Poster, text);
                }
                checkIfAllDone();
            }
            function hidePlot() {
                if (plotOnLeft()) {
                    $('#plot_box').animate({left: '-50%'});
                } else {
                    $('#plot_box').animate({left: '150%'});
                }
            }
            function setPoster(URL, text) {
                hidePlot();
                for (i = 0; i < 5; i++) {
                    $('p').clone(true).append('#topBar');
                    if (array_of_captions[i].text() === 'NominationEmpty') {
                        if (URL === 'N/A') {
                            array_of_nominations[i].attr('src', 'images/no_poster.jpg')
                        } else {
                            array_of_nominations[i].attr("src", URL);
                        }
                        array_of_captions[i].html(text);
                        break;
                    }
                }
                
            }
            $('.img_row img').click(function() {
                if (allDone) doneBannerOff();
                array_of_captions[$(this).attr('id').charAt(4) - 1].html("Nomination<br>Empty");
                $(this).attr('src', 'images/nomination_empty.jpg');
                $(this).css('filter','')
                allDone = false;
                
            })
            $('.img_row img').hover(function() {
                if($(this).attr('src') !== 'images/nomination_empty.jpg') {
                    $(this).css('transition', '0.5s');
                    $(this).css('filter', 'drop-shadow(0 0 20px red)')
                } 
            },function() {
                $(this).css('transition', '0.5s');
                $(this).css('filter', 'grayscale(0)');
                $(this).css('transition', '2.5s');
            })
            function checkIfAllDone() {
                allDone = true;
                for(i = 0; i < 5; i++) {
                    if (array_of_captions[i].text() === 'NominationEmpty') {
                        allDone = false;
                        break;
                    }
                }
                if (allDone) doneBannerOn(); 
            }
            function doneBannerOn() {
                hidePlot();
                $('#nominations').css('bottom', '10%');
                $('#nominations').css('background-color', '#EEC200');
                if (parseInt($('#topBar').css('width')) > 1000) $('#nominations').css('left','10%').css('right','10%');
                $('#nominations').css('border-radius', '5%');
                $('#nominations').css('z-index', '51');
                $('.img_row img').css('width', '100%');
                $('.img_row').css('padding-right', '1%').css('padding-left', '1%');
                $('th').html('Your five nominations are:');
                $('th').css('font-size', '2em');
                $('p').css('font-weight', 'bold')
            }
            function doneBannerOff() {
                $('#plot_box').hide();
                $('#nominations').css('bottom', '0');
                $('#nominations').css('background-color', '#FCEBDB');
                if (parseInt($('#topBar').css('width')) > 1000) $('#nominations').css('left','20%').css('right','20%');
                $('#nominations').css('border-radius', '1.5%');
                $('#nominations').css('z-index', '49');
                $('.img_row img').css('padding', '0', '0')
                $('.img_row img').css('width', '75%');
                $('th').html('Please finish your nominations again:');
                $('th').css('font-size', '1em');
                $('p').css('font-weight', 'normal')
                
            }
        </script>
    </body>
</html>