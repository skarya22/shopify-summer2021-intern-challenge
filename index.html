<!DOCTYPE html>
<link rel="stylesheet" href="stylesheet.css">
<html>
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"> 
        <title>
            The Shoppies
        </title>
    </head>
    <body>
        <h1>&#x1F6C8</h1>
        <div id='info_box'>
            <h2 id='close_button'>&#10005</h2>
            <h3>
                This project was built by Saagar Arya<br>
            </h3>
            <img id='me' src="images/me.jpg">
            <h4>for the UX & Web Developer Intern Challenge<br>
                Summer 2021 by Shopify.
            </h4>
            <h5>
                <a href="https://github.com/skarya22/shopify-summer2021-intern-challenge" target="_blank">Click here to see this project on GitHub</a><br>
                <a href="https://www.linkedin.com/in/saagar-arya/" target="_blank">Click here to connect on LinkedIn</a>
            </h5>
        </div>
        <div id="topBar">
            <h3 style="color: #06457c">
                Summer 2021 - Shopify Developer Intern Challenge:
            </h3> 
            <h2>
                The Shoppies: Movie Awards for Entrepreneurs
            </h2>
        </div>
        <div id="behind_topBar">
            <h3>
                Summer 2021 - Shopify Developer Intern Challenge:
            </h3> 
            <h2>
                The Shoppies: Movie Awards for Entrepreneurs
            </h2>
        </div>
        <form onSubmit="return search($('input[id=movie_name]').val(),1)">
            <button type="button" id='prev_button'>&#8592 Previous Movies</button>
            <input type="text" id="movie_name" placeholder=" Enter Movie Name Here">
            <input type="submit" value='Search'></input>
            <button type="button" id='next_button'>More Movies &#8594</button>
        </form>
        <p id="list"><br></p>
        <div id='buttons'>
            <button type='button' id='button_0'></button>
            <button type='button' id='button_1'></button>
            <button type='button' id='button_2'></button>
            <button type='button' id='button_3'></button>
            <button type='button' id='button_4'></button>
            <p></p>
            <button type='button' id='button_5'></button>
            <button type='button' id='button_6'></button>
            <button type='button' id='button_7'></button>
            <button type='button' id='button_8'></button>
            <button type='button' id='button_9'></button>
        </div>
        <p id='after_buttons'></p>
        <div id='whitespace'></div>
        <div id='plot_box'>
            <img id='hover_img' style='width: 70%;'>
            <h4 id='movie_title' style="margin:0"></h4>
            <p id='plot_p' style='color: black'></p>
            <p id='actors_p' style='color: #FEAD9A'></p>
            <p id='rotten_p' style='color: #FEAD9A'></p>
            <p id='imdb_p' style="color: #EEC200"></p>
        </div>
        <div>
            <div id="nominations">
                <table>
                    <th colspan=5>Nominations:</th>
                    <tr>
                        <td class='img_row'><img src="images/nomination_empty.jpg" alt="" id="img_1"></td>
                        <td class='img_row'><img src="images/nomination_empty.jpg" alt="" id="img_2"></td>
                        <td class='img_row'><img src="images/nomination_empty.jpg" alt="" id="img_3"></td>
                        <td class='img_row'><img src="images/nomination_empty.jpg" alt="" id="img_4"></td>
                        <td class='img_row'><img src="images/nomination_empty.jpg" alt="" id="img_5"></td>
                    </tr>
                    <tr>
                        <td><p id="caption_1">Nomination<br>Empty</p></td>
                        <td><p id="caption_2">Nomination<br>Empty</p></td>
                        <td><p id="caption_3">Nomination<br>Empty</p></td>
                        <td><p id="caption_4">Nomination<br>Empty</p></td>
                        <td><p id="caption_5">Nomination<br>Empty</p></td>
                    </tr>
                    <tr>
                        <td colspan=5><h6 style="margin: 0.5%;">(Click on a movie poster to remove it)</h6></td>
                    </tr>
                </table>
            </div>
        </div>
        <script>
            array_of_nominations = [$('#img_1'), $('#img_2'), $('#img_3'), $('#img_4'), $('#img_5')]
            array_of_captions = [$('#caption_1'), $('#caption_2'), $('#caption_3'), $('#caption_4'), $('#caption_5')]
            array_of_data = [];
            currentPage = 1;
            currentString = "";
            allDone = false; //allDone is true when all five nominations are chosen
            function search(String, page) {
                currentPage = page;
                currentString = String;
                $('#prev_button').css('display','inline');
                $('#next_button').css('display','inline');
                if (page > 1) {
                    $('#prev_button').css('background-color','')
                } else {
                    $('#prev_button').css('background-color', 'gray');
                }
                $('input').animate({'margin-top': '0.5%'})
                hidePlot();
                $.get("https://www.omdbapi.com/?apikey=950b4470&s=" + String + "&type=movie&page=" + page, function(data) {
                    if (data.Response === "False") {
                        $('#buttons button').hide();
                        $('buttons button').css('display', 'none');
                        $('#list').html('<br>No Results');
                        $('#next_button').hide();
                        return false;
                    } 
                    array_of_data = [];
                    for (i = 0; i < 10 && i < parseInt(data.totalResults) - 10*(page - 1); i++) {
                        movie = data.Search[i].Title + " (" + data.Search[i].Year +  ")";
                        $('#button_' + i).html(movie);
                        id = data.Search[i].imdbID
                        $('#button_' + i).attr('onclick', 'nominate("' + i + '")');
                        $('#button_' + i).show();
                        $('#button_' + i).css('display', 'inline');
                        addData(id, i, array_of_data);
                    }
                    for (i = 0; i < parseInt(data.totalResults) + 1 - 10*(page - 1); i++) {
                        for (k = 0; k < array_of_captions.length; k++) {
                            if ($('#button_' + i).text() === array_of_captions[k].text()) {
                                $('#button_' + i).css('background-color', 'gray');
                                break;
                            } else {
                                $('#button_' + i).css('background-color', '');
                            }
                        }
                    }
                    if ((parseInt(data.totalResults)) - 10*(page) > 0) {
                        $('#next_button').css('background-color', '');
                    } else {
                        $('#next_button').css('background-color', 'gray');
                    }
                });
                $('#list').html('Hover over a movie name to see more information,<br>click on a movie title to nominate it.')
                return false; 
            }
            $('#next_button').click(function() {
                if ($(this).css('background-color') != 'rgb(128, 128, 128)') {
                    search(currentString, currentPage + 1)
                }
                
            })
            $('#prev_button').click(function() {
                if ($(this).css('background-color') != 'rgb(128, 128, 128)') {
                    search(currentString, currentPage - 1)
                }
            })
            //helper function that adds each movie's dataset to array_of_data
            function addData(id, i, array) {
                $.get("https://www.omdbapi.com/?apikey=950b4470&i=" + id, function(data) {
                    array[i] = data;
                });
            }
            //nominate function 
            function nominate(num) {
                $('#button_' + num).css("background-color", "gray")
                hidePlot();
                $('#nominations').animate({bottom: '0'});
                isOnList = false;
                data = array_of_data[num];
                text = data.Title + " (" + data.Year + ")";
                for (i = 0; i < 5; i++) {
                    if (array_of_captions[i].text() === text) {
                        isOnList = true;
                    }
                }
                if (!isOnList) {
                    setPoster(data.Poster, text);
                    checkIfAllDone();
                }
            }
            //this function checks if 5 movies have been nominated
            function checkIfAllDone() {
                allDone = true;
                for(i = 0; i < 5; i++) {
                    if (array_of_captions[i].text() === 'NominationEmpty') {
                        allDone = false;
                        break;
                    }
                }
                if (allDone) doneBannerOn(); 
            }
            //this function sets the posters in the nomination bar
            function setPoster(URL, text) {
                for (i = 0; i < 5; i++) {
                    if (array_of_captions[i].text() === 'NominationEmpty') {
                        if (URL === 'N/A') {
                            array_of_nominations[i].attr('src', 'images/no_poster.jpg')
                        } else {
                            array_of_nominations[i].attr("src", URL);
                        }
                        array_of_captions[i].html(text);
                        break;
                    }
                }
            }
            //this listener brings the plotbox into view and highlights the buttons, if movie is not nominated
            $('#buttons button').mouseenter(function() {
                if ($(this).css('background-color') != 'rgb(128, 128, 128)') {
                    num = $(this).attr('id').substring(7,8);
                    this_data = array_of_data[num];
                    if (this_data === null || this_data.Poster === 'N/A' || this_data.Poster == null) {
                        $('#hover_img').attr('src','images/no_poster.jpg');
                    } else {
                        $('#hover_img').attr('src',this_data.Poster);
                    }
                    $('#hover_img').on('load', function() {
                        $('#movie_title').html(this_data.Title + " (" + this_data.Year + ")")
                        $('#plot_p').html(this_data.Plot);
                        $('#actors_p').html("Actors: " + this_data.Actors );
                        if (this_data.Ratings[1] != null) {
                            $('#rotten_p').html("Rotten Tomatoes: " + this_data.Ratings[1].Value);
                        } else {
                            $('#rotten_p').html('Rotten Tomatoes: N/A');
                        }
                        if (this_data.imdbRating != null) {
                            $('#imdb_p').html('imdb Rating: ' + this_data.imdbRating);
                        }
                    })
                    isOnLeft = plotOnLeft();
                    if (isOnLeft && parseInt($('#plot_box').css('left')) < 0) {
                        $('#plot_box').animate({left: '0%'});
                    } else if (!isOnLeft && parseInt($('#plot_box').css('left')) > parseInt($('#topBar').css('left'))) {
                        $('#plot_box').animate({left: '75%'});
                    }
                    $('#plot_box').show(); 
                }        
            })
            //this returns true if the plotbox is on the left
            function plotOnLeft() {
                halfScreenWidth = parseInt($('#topBar').css('width'))/2;
                leftWidth = parseInt($('#plot_box').css('left').substring(0,$('#plot_box').css('left').length - 2))
                if (halfScreenWidth < leftWidth) {
                    return false;
                } else {
                    return true;
                }
            }
            //this moves plotbox to other sides
            $('#plot_box').mouseenter(function() {
                if (allDone) {
                    hidePlot();
                    return;
                }
                if (plotOnLeft()) {
                    $('#plot_box').animate({left:'72.5%'});
                } else {
                    $('#plot_box').animate({left: '0%'});
                }
            })
            //this function hides the plotbox
            function hidePlot() {
                if (plotOnLeft()) {
                    $('#plot_box').animate({left: '-50%'});
                } else {
                    $('#plot_box').animate({left: '150%'});
                }
            }
            //this function removes movies from nominations
            $('.img_row img').click(function() {
                if (allDone) doneBannerOff();
                for (i = 0; i < array_of_data.length; i++) {
                    if ($('#button_' + i).text() == array_of_captions[$(this).attr('id').charAt(4) - 1].text()) {
                        $('#button_' + i).css('background-color', '');
                        break;
                    }
                }
                array_of_captions[$(this).attr('id').charAt(4) - 1].html("Nomination<br>Empty");
                $(this).attr('src', 'images/nomination_empty.jpg');
                $(this).css('filter','')
                allDone = false;
                hidePlot();
            })
            //this function makes the nominated posters highlight red
            $('.img_row img').hover(function() {
                if($(this).attr('src') !== 'images/nomination_empty.jpg') {
                    $(this).css('transition', '0.5s');
                    $(this).css('filter', 'drop-shadow(0 0 20px red)')
                } 
            },function() {
                $(this).css('transition', '0.5s');
                $(this).css('filter', 'grayscale(0)');
                $(this).css('transition', '2.5s');
            })
            function doneBannerOn() {
                hidePlot();
                $('#nominations').css('bottom', '10%');
                $('#nominations').css('background-color', '#EEC200');
                if (parseInt($('#topBar').css('width')) > 1000) $('#nominations').css('left','10%').css('right','10%');
                $('#nominations').css('border-radius', '5%');
                $('#nominations').css('z-index', '51');
                $('.img_row img').css('width', '100%');
                $('.img_row').css('padding-right', '1%').css('padding-left', '1%');
                $('th').html('Your five nominations are:');
                $('th').css('font-size', '2em');
                $('table p').css('font-weight', 'bold')
            }
            function doneBannerOff() {
                $('#plot_box').hide();
                $('#nominations').css('bottom', '0');
                $('#nominations').css('background-color', '#FCEBDB');
                if (parseInt($('#topBar').css('width')) > 1000) $('#nominations').css('left','20%').css('right','20%');
                $('#nominations').css('border-radius', '1.5%');
                $('#nominations').css('z-index', '49');
                $('.img_row img').css('padding', '0', '0')
                $('.img_row img').css('width', '75%');
                $('th').html('Please finish your nominations again:');
                $('th').css('font-size', '1em');
                $('table p').css('font-weight', 'normal')
            }
            $('h1').hover(function() {
                $('#info_box').css('display','inline');
                $('#info_box').animate({left: '30%'})
            },)
            $('#close_button').click(function() {
                $('#info_box').animate({left: '-50%'})
            })
        </script>
    </body>
</html>